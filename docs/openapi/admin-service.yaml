openapi: 3.0.3
info:
  title: Giga Admin Aggregation Service API
  description: |
    Multi-tenant admin service respecting NIPOST hierarchical structure.
    Supports National HQ, State Centers, and Local Branch views with RLS policies.
  version: 1.0.0

servers:
  - url: https://admin-service.railway.app/api
    description: Production server
  - url: http://localhost:3006/api
    description: Local development server

security:
  - BearerAuth: []

tags:
  - name: National
    description: National HQ level operations
  - name: State
    description: State Center level operations
  - name: Branch
    description: Branch level operations
  - name: Audit
    description: Audit trail operations

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      security: []
      responses:
        '200':
          description: Service is healthy

  # ============================================
  # NATIONAL LEVEL ENDPOINTS
  # ============================================
  /admin/national/dashboard:
    get:
      tags:
        - National
      summary: Get national dashboard
      description: Retrieve nationwide aggregated statistics (National HQ only)
      responses:
        '200':
          description: National dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NationalDashboard'
        '403':
          description: Access denied - National access required

  /admin/national/financial-summary:
    get:
      tags:
        - National
      summary: Get national financial summary
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Financial summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FinancialSummary'

  /admin/national/states:
    get:
      tags:
        - National
      summary: Get all states
      description: List all states in the system
      responses:
        '200':
          description: List of states
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/State'

  # ============================================
  # STATE LEVEL ENDPOINTS
  # ============================================
  /admin/state/{stateId}/dashboard:
    get:
      tags:
        - State
      summary: Get state dashboard
      description: Retrieve state-level aggregated statistics
      parameters:
        - name: stateId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: State dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StateDashboard'
        '403':
          description: Access denied

  /admin/state/{stateId}/branches:
    get:
      tags:
        - State
      summary: Get branches in state
      parameters:
        - name: stateId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of branches
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Branch'

  /admin/state/{stateId}/financial-summary:
    get:
      tags:
        - State
      summary: Get state financial summary
      parameters:
        - name: stateId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: State financial summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FinancialSummary'

  # ============================================
  # BRANCH LEVEL ENDPOINTS
  # ============================================
  /admin/branch/{branchId}/dashboard:
    get:
      tags:
        - Branch
      summary: Get branch dashboard
      parameters:
        - name: branchId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Branch dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BranchDashboard'

  /admin/branch/{branchId}/transactions:
    get:
      tags:
        - Branch
      summary: Get branch transactions
      parameters:
        - name: branchId
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: module
          in: query
          schema:
            type: string
            enum: [hotel, taxi, ecommerce]
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Paginated transaction list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionListResponse'

  /admin/branch/{branchId}/analytics:
    get:
      tags:
        - Branch
      summary: Get branch analytics
      parameters:
        - name: branchId
          in: path
          required: true
          schema:
            type: string
        - name: period
          in: query
          schema:
            type: string
            enum: [day, week, month]
            default: week
      responses:
        '200':
          description: Branch analytics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BranchAnalytics'

  # ============================================
  # AUDIT ENDPOINTS
  # ============================================
  /admin/audit-trail:
    get:
      tags:
        - Audit
      summary: Get audit trail
      description: Retrieve audit trail (filtered by access level via RLS)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: actionType
          in: query
          schema:
            type: string
        - name: startDate
          in: query
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Audit trail entries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditTrailResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    NationalDashboard:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            states:
              type: integer
            branches:
              type: integer
            hotels:
              type: integer
            ecommerce:
              type: integer
            taxi:
              type: integer
            totalRevenue:
              type: number
            totalCommission:
              type: number

    StateDashboard:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            stateId:
              type: string
            branches:
              type: integer
            hotels:
              type: integer
            ecommerce:
              type: integer
            taxi:
              type: integer
            totalRevenue:
              type: number
            totalCommission:
              type: number

    BranchDashboard:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            branchId:
              type: string
            hotels:
              type: integer
            ecommerce:
              type: integer
            taxi:
              type: integer
            totalRevenue:
              type: number
            totalCommission:
              type: number

    FinancialSummary:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            totalTransactions:
              type: integer
            totalRevenue:
              type: number
            totalCommission:
              type: number
            byModule:
              type: object
              properties:
                hotel:
                  type: number
                taxi:
                  type: number
                ecommerce:
                  type: number

    TransactionListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Transaction'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Transaction:
      type: object
      properties:
        id:
          type: string
          format: uuid
        transactionId:
          type: string
        module:
          type: string
        grossAmount:
          type: number
        commissionAmount:
          type: number
        netAmount:
          type: number
        paymentStatus:
          type: string
        createdAt:
          type: string
          format: date-time

    BranchAnalytics:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            period:
              type: string
            transactions:
              type: integer
            revenue:
              type: number
            commission:
              type: number
            byModule:
              type: object

    AuditTrailResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/AuditEntry'
        pagination:
          $ref: '#/components/schemas/Pagination'

    AuditEntry:
      type: object
      properties:
        id:
          type: string
          format: uuid
        adminId:
          type: string
        adminName:
          type: string
        actionType:
          type: string
        resourceType:
          type: string
        createdAt:
          type: string
          format: date-time

    State:
      type: object
      properties:
        stateId:
          type: string
        stateName:
          type: string

    Branch:
      type: object
      properties:
        branchId:
          type: string
        branchName:
          type: string

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        pages:
          type: integer
